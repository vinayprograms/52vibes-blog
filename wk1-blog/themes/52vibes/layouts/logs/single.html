{{ define "main" }}
<div class="logs-wrapper">
  <aside class="logs-sidebar-fixed">
    <h2>Sessions</h2>
    <nav class="logs-nav">
      {{ $currentPath := .RelPermalink }}
      {{ range (site.GetPage "logs").Sections }}
      {{ if .Sections }}
      <details {{ if hasPrefix $currentPath .RelPermalink }}open{{ end }}>
        <summary>
          <span class="logs-week-title">{{ .Title }}</span>
        </summary>
        <div class="logs-subsections">
          {{ range .Sections }}
          <details {{ if hasPrefix $currentPath .RelPermalink }}open{{ end }}>
            <summary>
              <span class="logs-experiment-title">{{ .Title }}</span>
              <span class="logs-count">{{ len .Pages }}</span>
            </summary>
            <ul>
              {{ range .Pages.ByWeight }}
              <li>
                <a href="{{ .RelPermalink }}" {{ if eq $currentPath .RelPermalink }}class="active"{{ end }}>{{ .Title }}</a>
              </li>
              {{ end }}
            </ul>
          </details>
          {{ end }}
        </div>
      </details>
      {{ else }}
      <details {{ if hasPrefix $currentPath .RelPermalink }}open{{ end }}>
        <summary>
          <span class="logs-week-title">{{ .Title }}</span>
          <span class="logs-count">{{ len .Pages }}</span>
        </summary>
        <ul>
          {{ range .Pages.ByWeight }}
          <li>
            <a href="{{ .RelPermalink }}" {{ if eq $currentPath .RelPermalink }}class="active"{{ end }}>{{ .Title }}</a>
          </li>
          {{ end }}
        </ul>
      </details>
      {{ end }}
      {{ end }}
    </nav>
  </aside>

  <div class="logs-content-area">
    <article>
      <header>
        <h1>{{ .Title }}</h1>
        <p class="meta">
          {{ with .Params.agent }}{{ . }} · {{ end }}
          {{ with .Params.duration }}{{ . }}{{ end }}
          {{ with .Parent }} · <a href="{{ .RelPermalink }}">{{ .Title }}</a>{{ end }}
        </p>
      </header>

      <nav class="toc-mobile">
        <details>
          <summary>Browse sessions</summary>
          <div class="logs-nav">
            {{ range (site.GetPage "logs").Sections }}
            {{ if .Sections }}
            <div class="logs-mobile-group">
              <strong>{{ .Title }}</strong>
              {{ range .Sections }}
              <div class="logs-mobile-subgroup">
                <em>{{ .Title }}</em>
                <ul>
                  {{ range .Pages.ByWeight }}<li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>{{ end }}
                </ul>
              </div>
              {{ end }}
            </div>
            {{ else }}
            <div class="logs-mobile-group">
              <strong>{{ .Title }}</strong>
              <ul>
                {{ range .Pages.ByWeight }}<li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>{{ end }}
              </ul>
            </div>
            {{ end }}
            {{ end }}
          </div>
        </details>
      </nav>

      <div class="content">
        {{ .Content }}
      </div>

      {{/* Navigate by weight order */}}
      {{ $pages := .Parent.Pages.ByWeight }}
      {{ $currentIndex := 0 }}
      {{ range $i, $p := $pages }}
        {{ if eq $p.RelPermalink $.RelPermalink }}
          {{ $currentIndex = $i }}
        {{ end }}
      {{ end }}
      <nav class="post-nav">
        {{ if gt $currentIndex 0 }}
        {{ $prev := index $pages (sub $currentIndex 1) }}
        <a href="{{ $prev.RelPermalink }}" class="prev">← {{ $prev.Title }}</a>
        {{ end }}
        {{ if lt $currentIndex (sub (len $pages) 1) }}
        {{ $next := index $pages (add $currentIndex 1) }}
        <a href="{{ $next.RelPermalink }}" class="next">{{ $next.Title }} →</a>
        {{ end }}
      </nav>
    </article>
  </div>
</div>
{{ end }}
